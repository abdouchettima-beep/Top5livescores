<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öΩ Live Football Scores</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  /* Reset */
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Roboto', sans-serif; background:#121212; color:#fff; }

  /* Header */
  header {
    background: linear-gradient(90deg,#1e3c72,#2a5298);
    text-align:center;
    font-size:1.9em;
    font-weight:700;
    padding:18px;
    position: sticky;
    top:0;
    z-index:100;
    box-shadow:0 4px 10px rgba(0,0,0,0.5);
  }

  /* Ad Banner */
  #admob-banner {
    margin:15px auto;
    width:90%;
    max-width:500px;
    height:60px;
    background:#1e1e1e;
    color:#aaa;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:12px;
    font-weight:500;
    box-shadow:0 4px 6px rgba(0,0,0,0.3);
  }

  /* League Buttons */
  nav { display:flex; justify-content:center; flex-wrap:wrap; gap:6px; margin:12px 0; }
  nav button {
    flex:1 1 120px;
    padding:12px 10px;
    border:none;
    border-radius:10px;
    background:#222;
    color:#fff;
    font-weight:500;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 2px 6px rgba(0,0,0,0.5);
  }
  nav button:hover { background:#333; transform:translateY(-2px); }
  nav button.active { background:#1e90ff; box-shadow:0 4px 12px rgba(30,144,255,0.6); }

  .league-logo { width:24px; height:24px; object-fit:contain; filter:drop-shadow(0 0 4px #fff); }

  /* Toggle Buttons */
  .toggle-bar { display:flex; justify-content:center; gap:10px; margin:12px 0; }
  .toggle-bar button {
    padding:10px 18px;
    border:none;
    border-radius:10px;
    background:#222;
    color:#fff;
    font-weight:500;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 2px 6px rgba(0,0,0,0.5);
  }
  .toggle-bar button.active { background:#28a745; box-shadow:0 4px 10px rgba(40,167,69,0.6); transform:translateY(-2px); }

  /* Section titles */
  .section-title { margin:18px 0 12px; font-size:1.4em; font-weight:700; text-align:left; padding-left:5%; color:#fff; }

  /* Match Box */
  .match-box {
    background: linear-gradient(145deg, #1f1f1f, #2b2b2b);
    margin:12px auto;
    padding:16px;
    width:90%;
    max-width:520px;
    border-radius:16px;
    box-shadow:0 4px 12px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
    align-items:center;
    transition:0.3s;
  }
  .match-box:hover { transform:translateY(-4px); box-shadow:0 8px 16px rgba(0,0,0,0.8); }

  .teams { display:flex; align-items:center; justify-content:center; gap:14px; font-size:1.15em; font-weight:600; flex-wrap:wrap; text-align:center; }
  .team-logo { width:36px; height:36px; object-fit:contain; }

  .score { font-size:1.3em; margin:8px 0; padding:5px 10px; border-radius:8px; font-weight:700; color:#fff; }
  .time { font-size:1em; margin-top:4px; padding:4px 8px; border-radius:6px; font-weight:500; }
  .status { font-size:0.95em; margin-top:6px; padding:4px 10px; border-radius:8px; font-weight:600; }

  .placeholder { color:#888; font-style:italic; margin:14px 0; font-size:1em; text-align:center; }

  /* Loading and Error States */
  .loading { color: #1e90ff; text-align: center; margin: 20px 0; }
  .error { color: #ff4444; text-align: center; margin: 20px 0; padding: 10px; background: #2a1a1a; border-radius: 8px; }
  .debug-info { font-size: 0.8em; color: #888; margin-top: 10px; }

  /* Responsive */
  @media(max-width:480px){
    nav button { flex:1 1 100px; padding:10px 6px; font-size:0.9em; }
    .toggle-bar button { padding:8px 14px; font-size:0.9em; }
    .team-logo { width:28px; height:28px; }
  }
</style>
</head>
<body>

<header>‚öΩ Live Football Scores</header>

<div id="admob-banner">AdMob Banner Placeholder</div>

<nav>
  <button data-league="39" onclick="loadLeague(39,this)"><img class="league-logo" src="https://media.api-sports.io/football/leagues/39.png"> Premier League</button>
  <button data-league="140" onclick="loadLeague(140,this)"><img class="league-logo" src="https://media.api-sports.io/football/leagues/140.png"> La Liga</button>
  <button data-league="135" onclick="loadLeague(135,this)"><img class="league-logo" src="https://media.api-sports.io/football/leagues/135.png"> Serie A</button>
  <button data-league="78" onclick="loadLeague(78,this)"><img class="league-logo" src="https://media.api-sports.io/football/leagues/78.png"> Bundesliga</button>
  <button data-league="61" onclick="loadLeague(61,this)"><img class="league-logo" src="https://media.api-sports.io/football/leagues/61.png"> Ligue 1</button>
</nav>

<div class="toggle-bar">
  <button id="liveBtn" class="active" onclick="showSection('live')">Live Matches</button>
  <button id="upcomingBtn" onclick="showSection('upcoming')">Upcoming Matches</button>
</div>

<div id="status-message"></div>
<div id="live-matches"></div>
<div id="upcoming-matches" style="display:none;"></div>

<script>
// Replace this with your actual API key
const API_KEY = "YOUR_ACTUAL_API_KEY_HERE"; // IMPORTANT: Replace this!
const today = new Date();
let currentSeason = today.getMonth() >= 7 ? today.getFullYear() : today.getFullYear() - 1;
const leagueColors = {39:'#1E90FF',140:'#FF0000',135:'#00C851',78:'#FF8800',61:'#800080'};
const statusColors = {"NS":"#6c757d","1H":"#28a745","2H":"#28a745","HT":"#ffc107","FT":"#dc3545","PST":"#6c757d","CANC":"#6c757d","ABD":"#6c757d","LIVE":"#28a745"};

// Debug function to show status messages
function showStatus(message, type = 'info') {
  const statusDiv = document.getElementById('status-message');
  statusDiv.innerHTML = `<div class="${type === 'error' ? 'error' : 'loading'}">${message}</div>`;
  if (type !== 'error') {
    setTimeout(() => statusDiv.innerHTML = '', 3000);
  }
}

function getStatusBadge(status){
  const color = statusColors[status] || "#6c757d";
  const text = {"NS":"Not started","1H":"1st Half","2H":"2nd Half","HT":"Half-Time","FT":"Finished","PST":"Postponed","CANC":"Canceled","ABD":"Abandoned","LIVE":"Live"}[status] || status;
  return `<div class="status" style="background:${color}">${text}</div>`;
}

let currentLeagueId = 39;

async function loadLeague(leagueId, btn){
  currentLeagueId = leagueId;
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  
  if(document.getElementById("live-matches").style.display === "block") {
    await loadLiveMatches(leagueId);
  } else {
    await loadUpcomingMatches(leagueId);
  }
}

async function fetchWithRetry(url, options, retries = 3) {
  for (let i = 0; i < retries; i++) {
    try {
      console.log(`Attempt ${i + 1} to fetch:`, url);
      const response = await fetch(url, options);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
      }
      
      const data = await response.json();
      console.log('API Response received:', data);
      return data;
      
    } catch (error) {
      console.error(`Attempt ${i + 1} failed:`, error);
      if (i === retries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}

async function loadLiveMatches(leagueId){
  const url = `https://api-football-v1.p.rapidapi.com/v3/fixtures?live=all&league=${leagueId}&season=${currentSeason}`;
  const options = {
    method: "GET",
    headers: {
      "x-rapidapi-key": API_KEY,
      "x-rapidapi-host": "api-football-v1.p.rapidapi.com"
    }
  };
  
  const liveDiv = document.getElementById("live-matches");
  showStatus('Loading live matches...', 'loading');
  liveDiv.innerHTML = `<div class="section-title">üî¥ Live Matches</div>`;
  
  try {
    // Check if API key is still placeholder
    if (API_KEY.includes("YOUR_ACTUAL_API_KEY")) {
      throw new Error("Please replace the API_KEY placeholder with your actual API key");
    }
    
    const data = await fetchWithRetry(url, options);
    
    if (!data.response) {
      throw new Error("Invalid API response structure");
    }
    
    if (data.response.length === 0) {
      liveDiv.innerHTML += `<p class="placeholder">No live matches right now. Check back later!</p>`;
      showStatus('No live matches found', 'info');
      return;
    }
    
    data.response.forEach(match => {
      const box = document.createElement("div");
      box.className = "match-box";
      const color = leagueColors[leagueId] || '#1e90ff';
      const status = match.fixture.status.short === "LIVE" ? "LIVE" : match.fixture.status.short;
      
      box.innerHTML = `
        <div class="teams">
          <img class="team-logo" src="${match.teams.home.logo}" alt="${match.teams.home.name}" onerror="this.src='https://via.placeholder.com/36?text=HOME'"/>
          ${match.teams.home.name} vs 
          <img class="team-logo" src="${match.teams.away.logo}" alt="${match.teams.away.name}" onerror="this.src='https://via.placeholder.com/36?text=AWAY'"/>
          ${match.teams.away.name}
        </div>
        <div class="score" style="background:${color}">${match.goals.home ?? 0} - ${match.goals.away ?? 0}</div>
        <div class="time" style="background:${color}">‚è± ${match.fixture.status.elapsed || 0}'</div>
        ${getStatusBadge(status)}
        <div class="debug-info">Match ID: ${match.fixture.id}</div>
      `;
      liveDiv.appendChild(box);
    });
    
    showStatus(`Loaded ${data.response.length} live match(es)`, 'info');
    
  } catch (err) {
    console.error('Error loading live matches:', err);
    let errorMessage = `Error loading live matches: ${err.message}`;
    
    if (err.message.includes('Failed to fetch')) {
      errorMessage += '<br>This might be a CORS issue. Check browser console for details.';
    } else if (err.message.includes('quota')) {
      errorMessage += '<br>API quota might be exceeded. Try again later.';
    }
    
    liveDiv.innerHTML += `
      <div class="error">
        ${errorMessage}
        <div class="debug-info">URL: ${url}</div>
      </div>
    `;
    showStatus('Failed to load live matches', 'error');
  }
}

async function loadUpcomingMatches(leagueId){
  const url = `https://api-football-v1.p.rapidapi.com/v3/fixtures?league=${leagueId}&season=${currentSeason}&next=10&timezone=UTC`;
  const options = {
    method: "GET",
    headers: {
      "x-rapidapi-key": API_KEY,
      "x-rapidapi-host": "api-football-v1.p.rapidapi.com"
    }
  };
  
  const upDiv = document.getElementById("upcoming-matches");
  showStatus('Loading upcoming matches...', 'loading');
  upDiv.innerHTML = `<div class="section-title">üìÖ Upcoming Matches</div>`;
  
  try {
    // Check if API key is still placeholder
    if bcb3327d3417bafd64a44c4e92b40151 {
      throw new Error("Please replace the API_KEY placeholder with your actual API key");
    }
    
    const data = await fetchWithRetry(url, options);
    
    if (!data.response) {
      throw new Error("Invalid API response structure");
    }
    
    if (data.response.length === 0) {
      upDiv.innerHTML += `<p class="placeholder">No upcoming matches found for this league.</p>`;
      showStatus('No upcoming matches found', 'info');
      return;
    }
    
    data.response.forEach(match => {
      const date = new Date(match.fixture.date);
      const box = document.createElement("div");
      box.className = "match-box";
      const color = leagueColors[leagueId] || '#1e90ff';
      
      box.innerHTML = `
        <div class="teams">
          <img class="team-logo" src="${match.teams.home.logo}" alt="${match.teams.home.name}" onerror="this.src='https://via.placeholder.com/36?text=HOME'"/>
          ${match.teams.home.name} vs 
          <img class="team-logo" src="${match.teams.away.logo}" alt="${match.teams.away.name}" onerror="this.src='https://via.placeholder.com/36?text=AWAY'"/>
          ${match.teams.away.name}
        </div>
        <div class="time" style="background:${color}">Kick-off: ${date.toLocaleString()}</div>
        ${getStatusBadge(match.fixture.status.short)}
        <div class="debug-info">Match ID: ${match.fixture.id}</div>
      `;
      upDiv.appendChild(box);
    });
    
    showStatus(`Loaded ${data.response.length} upcoming match(es)`, 'info');
    
  } catch (err) {
    console.error('Error loading upcoming matches:', err);
    let errorMessage = `Error loading upcoming matches: ${err.message}`;
    
    if (err.message.includes('Failed to fetch')) {
      errorMessage += '<br>This might be a CORS issue. Check browser console for details.';
    } else if (err.message.includes('quota')) {
      errorMessage += '<br>API quota might be exceeded. Try again later.';
    }
    
    upDiv.innerHTML += `
      <div class="error">
        ${errorMessage}
        <div class="debug-info">URL: ${url}</div>
      </div>
    `;
    showStatus('Failed to load upcoming matches', 'error');
  }
}

function showSection(type){
  const live = document.getElementById("live-matches");
  const upcoming = document.getElementById("upcoming-matches");
  document.getElementById("liveBtn").classList.remove("active");
  document.getElementById("upcomingBtn").classList.remove("active");
  
  if(type === "live"){
    live.style.display = "block";
    upcoming.style.display = "none";
    document.getElementById("liveBtn").classList.add("active");
    loadLiveMatches(currentLeagueId);
  } else {
    live.style.display = "none";
    upcoming.style.display = "block";
    document.getElementById("upcomingBtn").classList.add("active");
    loadUpcomingMatches(currentLeagueId);
  }
}

// Auto-refresh every 30 seconds for live matches only
setInterval(() => {
  if(document.getElementById("live-matches").style.display === "block") {
    console.log('Auto-refreshing live matches...');
    loadLiveMatches(currentLeagueId);
  }
}, 30000);

// Initialize on load
window.onload = () => {
  console.log('Initializing football scores app...');
  console.log('Current season:', currentSeason);
  console.log('API Key present:', API_KEY && !API_KEY.includes("YOUR_ACTUAL_API_KEY"));
  
  loadLeague(currentLeagueId, document.querySelector(`nav button[data-league="${currentLeagueId}"]`));
};
</script>

</body>
</html>
