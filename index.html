<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Top 5 Leagues - Live & Upcoming</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: 'Roboto', sans-serif;
    background: #0a0a0a;
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }
  
  header {
    background: linear-gradient(90deg, #1EA36B, #1E90FF);
    padding: 15px;
    font-size: 1.4rem;
    font-weight: bold;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  
  .section-title {
    font-size: 1.2rem;
    font-weight: 700;
    margin-top: 20px;
    padding: 10px;
  }
  
  .match {
    background: #1b1b1b;
    border-radius: 10px;
    margin: 12px auto;
    padding: 12px;
    width: 90%;
    max-width: 480px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    transition: transform 0.2s;
  }
  
  .match:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(30, 144, 255, 0.3);
  }
  
  .match p {
    margin: 5px 0;
  }
  
  .live-indicator {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #ff0000;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
    margin-right: 5px;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }
  
  nav {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
    padding: 0 10px;
  }
  
  nav button {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #1E90FF;
    color: #fff;
    font-weight: 600;
    transition: all 0.3s;
  }
  
  nav button:hover {
    background: #007bff;
    transform: scale(1.05);
  }
  
  nav button.active {
    background: #1EA36B;
  }
  
  #toggleButtons {
    margin: 15px 0;
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 0 10px;
  }
  
  #toggleButtons button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #333;
    color: #fff;
    font-weight: 600;
    transition: all 0.3s;
  }
  
  #toggleButtons button:hover {
    background: #444;
  }
  
  #toggleButtons button.active {
    background: #1E90FF;
  }
  
  .error {
    color: #ff6b6b;
    padding: 20px;
    background: rgba(255, 107, 107, 0.1);
    border-radius: 8px;
    margin: 10px auto;
    width: 90%;
    max-width: 480px;
  }
  
  .loading {
    padding: 20px;
    color: #aaa;
    font-style: italic;
  }
  
  .score {
    font-size: 1.3rem;
    font-weight: bold;
    color: #1EA36B;
  }
  
  .no-matches {
    padding: 30px;
    color: #888;
    font-size: 1.1rem;
  }
</style>
</head>
<body>
  <header>‚öΩ Top 5 Leagues - Live Scores</header>

  <!-- League selection buttons -->
  <nav id="leagueNav">
    <button class="active" onclick="loadLeague(39, this)">Premier League</button>
    <button onclick="loadLeague(140, this)">La Liga</button>
    <button onclick="loadLeague(135, this)">Serie A</button>
    <button onclick="loadLeague(78, this)">Bundesliga</button>
    <button onclick="loadLeague(61, this)">Ligue 1</button>
  </nav>

  <!-- Toggle buttons -->
  <div id="toggleButtons">
    <button class="active" onclick="showMatches('live')">üî¥ Live Matches</button>
    <button onclick="showMatches('upcoming')">üìÖ Upcoming Matches</button>
  </div>

  <div id="matchesContainer">
    <div id="liveMatches">
      <div class="section-title">üî¥ Live Matches</div>
    </div>
    <div id="upcomingMatches" style="display:none">
      <div class="section-title">üìÖ Upcoming Matches</div>
    </div>
  </div>

<script>
// ============================================
// CONFIGURATION
// ============================================
const apiKey = "bcb3327d3417bafd64a44c4e92b40151";
const season = 2024;
const baseURL = "https://v3.football.api-sports.io";
const corsProxy = "https://corsproxy.io/?";
let currentLeagueId = 39;

// ============================================
// API FUNCTIONS
// ============================================
async function fetchAPI(url) {
  try {
    console.log("Fetching:", url);
    
    // Build the full URL with API key header embedded
    const fullURL = `${corsProxy}${encodeURIComponent(url)}`;
    
    const response = await fetch(fullURL, {
      method: 'GET',
      headers: {
        "x-rapidapi-key": apiKey,
        "x-rapidapi-host": "v3.football.api-sports.io"
      }
    });
    
    if (!response.ok) {
      console.error("HTTP Error:", response.status, response.statusText);
      const errorText = await response.text();
      console.error("Error details:", errorText);
      return null;
    }
    
    const data = await response.json();
    console.log("API Response:", data);
    console.log("Response length:", data?.response?.length);
    
    // Check for API errors
    if (data.errors && Object.keys(data.errors).length > 0) {
      console.error("API Errors:", data.errors);
    }
    
    return data;
  } catch (err) {
    console.error("Fetch error:", err);
    console.error("Error details:", err.message);
    return null;
  }
}

// ============================================
// LOAD LEAGUE DATA
// ============================================
async function loadLeague(leagueId, buttonEl) {
  currentLeagueId = leagueId;
  
  // Update active button state
  document.querySelectorAll('#leagueNav button').forEach(btn => btn.classList.remove('active'));
  if (buttonEl) buttonEl.classList.add('active');

  // Show loading states
  document.getElementById("liveMatches").innerHTML = `
    <div class='section-title'>üî¥ Live Matches</div>
    <div class='loading'>Loading live matches...</div>
  `;
  
  document.getElementById("upcomingMatches").innerHTML = `
    <div class='section-title'>üìÖ Upcoming Matches</div>
    <div class='loading'>Loading upcoming matches...</div>
  `;

  // ===== FETCH LIVE MATCHES =====
  const liveURL = `${baseURL}/fixtures?live=all&league=${leagueId}&season=${season}`;

  // ===== FETCH UPCOMING MATCHES =====
  const today = new Date();
  const todayStr = today.toISOString().split('T')[0];
  
  const nextMonth = new Date();
  nextMonth.setDate(nextMonth.getDate() + 30);
  const nextMonthStr = nextMonth.toISOString().split('T')[0];

  const upcomingURL = `${baseURL}/fixtures?league=${leagueId}&season=${season}&from=${todayStr}&to=${nextMonthStr}&status=NS`;

  // Fetch both APIs
  const [liveData, upcomingData] = await Promise.all([
    fetchAPI(liveURL),
    fetchAPI(upcomingURL)
  ]);

  // ===== DISPLAY LIVE MATCHES =====
  const liveContainer = document.getElementById("liveMatches");
  liveContainer.innerHTML = "<div class='section-title'>üî¥ Live Matches</div>";
  
  if (liveData?.errors && Object.keys(liveData.errors).length > 0) {
    liveContainer.innerHTML += `<div class='error'>‚ùå API Error: ${JSON.stringify(liveData.errors)}</div>`;
  } else if (liveData?.response && liveData.response.length > 0) {
    displayMatches(liveData.response, "liveMatches", true);
  } else {
    liveContainer.innerHTML += "<div class='no-matches'>No live matches at the moment</div>";
  }

  // ===== DISPLAY UPCOMING MATCHES =====
  const upcomingContainer = document.getElementById("upcomingMatches");
  upcomingContainer.innerHTML = "<div class='section-title'>üìÖ Upcoming Matches</div>";
  
  console.log("Upcoming data check:", upcomingData);
  console.log("Has response?", upcomingData?.response);
  console.log("Response length:", upcomingData?.response?.length);
  
  if (!upcomingData) {
    upcomingContainer.innerHTML += "<div class='error'>‚ùå Failed to fetch upcoming matches</div>";
  } else if (upcomingData?.errors && Object.keys(upcomingData.errors).length > 0) {
    upcomingContainer.innerHTML += `<div class='error'>‚ùå API Error: ${JSON.stringify(upcomingData.errors)}</div>`;
  } else if (upcomingData?.response && upcomingData.response.length > 0) {
    console.log("Processing", upcomingData.response.length, "matches");
    // Filter only upcoming matches
    const upcoming = upcomingData.response.filter(m => 
      m.fixture.status.short === 'NS' || m.fixture.status.short === 'TBD'
    );
    
    console.log("Filtered to", upcoming.length, "upcoming matches");
    
    if (upcoming.length > 0) {
      displayMatches(upcoming.slice(0, 15), "upcomingMatches", false);
    } else {
      upcomingContainer.innerHTML += "<div class='no-matches'>No upcoming matches scheduled (all filtered out)</div>";
    }
  } else {
    upcomingContainer.innerHTML += `<div class='no-matches'>No upcoming matches found. API returned: ${JSON.stringify(upcomingData)}</div>`;
  }
}

// ============================================
// TOGGLE BETWEEN LIVE AND UPCOMING
// ============================================
function showMatches(type) {
  // Update button states
  document.querySelectorAll('#toggleButtons button').forEach(btn => btn.classList.remove('active'));
  
  // Find and activate the correct button
  const buttons = document.querySelectorAll('#toggleButtons button');
  if (type === 'live') {
    buttons[0].classList.add('active');
  } else {
    buttons[1].classList.add('active');
  }
  
  // Toggle visibility
  document.getElementById("liveMatches").style.display = type === 'live' ? "block" : "none";
  document.getElementById("upcomingMatches").style.display = type === 'upcoming' ? "block" : "none";
}

// ============================================
// DISPLAY MATCHES
// ============================================
function displayMatches(matches, containerId, isLive) {
  const container = document.getElementById(containerId);
  
  if (!matches || matches.length === 0) {
    container.innerHTML += `<div class='no-matches'>${isLive ? 'No live matches right now' : 'No upcoming matches found'}</div>`;
    return;
  }
  
  matches.forEach(match => {
    const home = match.teams.home.name;
    const away = match.teams.away.name;
    const homeScore = match.goals.home ?? "-";
    const awayScore = match.goals.away ?? "-";
    const date = new Date(match.fixture.date);
    const formattedDate = date.toLocaleString('en-US', {
      weekday: 'short',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
    const status = match.fixture.status.long;
    const elapsed = match.fixture.status.elapsed;
    const round = match.league.round || '';

    let matchHTML = `
      <div class="match">
        <p style="font-size: 0.9rem; color: #888;">${round}</p>
        <p><strong>${home}</strong> vs <strong>${away}</strong></p>
        <p>üïí ${formattedDate}</p>
    `;

    // Show live status or match status
    if (isLive && elapsed) {
      matchHTML += `<p><span class="live-indicator"></span><strong style="color: #ff0000;">LIVE - ${elapsed}'</strong></p>`;
      matchHTML += `<p class="score">${homeScore} - ${awayScore}</p>`;
    } else if (isLive) {
      matchHTML += `<p><span class="live-indicator"></span><strong style="color: #ff0000;">LIVE</strong></p>`;
      matchHTML += `<p class="score">${homeScore} - ${awayScore}</p>`;
    } else {
      matchHTML += `<p>üìä ${status}</p>`;
    }

    matchHTML += `</div>`;
    
    container.innerHTML += matchHTML;
  });
}

// ============================================
// INITIALIZE
// ============================================
console.log("Initializing app with API Key:", apiKey);
loadLeague(currentLeagueId);

// Auto-refresh live matches every 30 seconds
setInterval(() => {
  if (document.getElementById("liveMatches").style.display !== "none") {
    console.log("Auto-refreshing live matches...");
    loadLeague(currentLeagueId);
  }
}, 30000);
</script>
</body>
</html>
